<template name="stockMarketing">
  <div class="{styles.stockMarketing}">
    <!--查询条件-->
    <conditionsStock {onSearch} showDept showCategory showBrand showDataRange showDate showDateType />
    <div class="{styles.pageCnt}">
      <h2 class="{styles.pageTitle}">库存健康监控</h2>
      <stockMarketingSummary />
    </div>
    <stockMarketingMap />
  </div>
</template>

<template name="stockMarketingSummary">
  <!--summary:start-->
  <fj-Row class="{styles.summary} clearfix">
    <#if {stockMarketing.tabItems[0].checked}>
    <fj-Col l="3">
      <div class="{styles.summaryItem}">
        <div class="{styles.field}">库存金额（万元）</div>
        <div class="{styles.num}">{stockMarketing.summaryData.stockMoney} <span>万元</span></div>
        <!-- <div class="tc"><img src="{iconGraph}" alt=""></div> -->
        <div class="{styles.rates} clearfix">
          <div class="{stockMarketing.summaryData.stockMoneyGrowth >(0) ?(styles.red,styles.green)} fr">
            <div>{stockMarketing.summaryData.stockMoneyGrowth >(0) ?('+','')}{stockMarketing.summaryData.stockMoneyGrowth}%</div>
          </div>
        </div>
      </div>
    </fj-Col>
    </#if>
    <#if {stockMarketing.tabItems[1].checked}>    
    <fj-Col l="3">
      <div class="{styles.summaryItem}">
        <div class="{styles.field}">PV现货率
          <ant-Popover content={popCntPV} title="指标释义">
            <ant-Icon type="question-circle" />
          </ant-Popover>
        </div>
        <div class="{styles.num}">{stockMarketing.summaryData.pvRates} <span>%</span></div>
        <!-- <div class="tc"><img src="{iconGraph}" alt=""></div> -->
        <div class="{styles.rates} clearfix">
          <div class="{stockMarketing.summaryData.pvRatesGrowth >(0) ?(styles.red,styles.green)} fr">
            <div>{stockMarketing.summaryData.pvRatesGrowth >(0) ?('+','')}{stockMarketing.summaryData.pvRatesGrowth}%</div>
          </div>
        </div>
      </div>
    </fj-Col>
    </#if>
    <#if {stockMarketing.tabItems[2].checked}>    
    <fj-Col l="3">
      <div class="{styles.summaryItem}">
        <div class="{styles.field}">实物现货率(中小件)
          <ant-Popover content={popCntInStock} title="指标释义">
            <ant-Icon type="question-circle" />
          </ant-Popover>
        </div>
        <div class="{styles.num}">{stockMarketing.summaryData.inStockRates} <span>%</span></div>
        <!-- <div class="tc"><img src="{iconGraph}" alt=""></div> -->
        <div class="{styles.rates} clearfix">
          <div class="{stockMarketing.summaryData.inStockRatesGrowth >(0) ?(styles.red,styles.green)} fr">
            <div>{stockMarketing.summaryData.inStockRatesGrowth >(0) ?('+','')}{stockMarketing.summaryData.inStockRatesGrowth}%</div>
          </div>
        </div>
      </div>
    </fj-Col>
    </#if>
    <#if {stockMarketing.tabItems[3].checked}>    
    <fj-Col l="3">
      <div class="{styles.summaryItem}">
        <div class="{styles.field}">实物现货率(大件)
          <ant-Popover content={popCntInStockBig} title="指标释义">
            <ant-Icon type="question-circle" />
          </ant-Popover>
        </div>
        <div class="{styles.num}">{stockMarketing.summaryData.inStockRatesBig} <span>%</span></div>
        <!-- <div class="tc"><img src="{iconGraph}" alt=""></div> -->
        <div class="{styles.rates} clearfix">
          <div class="{stockMarketing.summaryData.inStockRatesGrowthBig >(0) ?(styles.red,styles.green)} fr">
            <div>{stockMarketing.summaryData.inStockRatesGrowthBig >(0) ?('+','')}{stockMarketing.summaryData.inStockRatesGrowthBig}%</div>
          </div>
        </div>
      </div>
    </fj-Col>
    </#if>
    <#if {stockMarketing.tabItems[4].checked}>    
    <fj-Col l="3">
      <div class="{styles.summaryItem}">
        <div class="{styles.field}">周转天数
          <ant-Popover content={popCntTransferDays} title="指标释义">
            <ant-Icon type="question-circle" />
          </ant-Popover>
        </div>
        <div class="{styles.num}">{stockMarketing.summaryData.transferDays} <span>天</span></div>
        <!-- <div class="tc"><img src="{iconGraph}" alt=""></div> -->
        <div class="{styles.rates} clearfix">
          <div class="{stockMarketing.summaryData.transferDaysGrowth >(0) ?(styles.red,styles.green)} fr">
            <div>{stockMarketing.summaryData.transferDaysGrowth >(0) ?('+','')}{stockMarketing.summaryData.transferDaysGrowth}%</div>
          </div>
        </div>
      </div>
    </fj-Col>
    </#if>
    <#if {stockMarketing.tabItems[5].checked}>    
    <fj-Col l="3">
      <div class="{styles.summaryItem}">
        <div class="{styles.field}">畅销品现货率(中小件)
          <ant-Popover content={popCntBigSales} title="指标释义">
            <ant-Icon type="question-circle" />
          </ant-Popover>
        </div>
        <div class="{styles.num}">{stockMarketing.summaryData.bigSales} <span>%</span></div>
        <!-- <div class="tc"><img src="{iconGraph}" alt=""></div> -->
        <div class="{styles.rates} clearfix">
          <div class="{stockMarketing.summaryData.bigSalesGrowth >(0) ?(styles.red,styles.green)} fr">
            <div>{stockMarketing.summaryData.bigSalesGrowth >(0) ?('+','')}{stockMarketing.summaryData.bigSalesGrowth}%</div>
          </div>
        </div>
      </div>
    </fj-Col>
    </#if>
    <#if {stockMarketing.tabItems[6].checked}>    
    <fj-Col l="3">
      <div class="{styles.summaryItem}">
        <div class="{styles.field}">畅销品现货率(大件)
          <ant-Popover content={popCntBigSalesBig} title="指标释义">
            <ant-Icon type="question-circle" />
          </ant-Popover>
        </div>
        <div class="{styles.num}">{stockMarketing.summaryData.bigSalesBig} <span>%</span></div>
        <!-- <div class="tc"><img src="{iconGraph}" alt=""></div> -->
        <div class="{styles.rates} clearfix">
          <div class="{stockMarketing.summaryData.bigSalesGrowthBig >(0) ?(styles.red,styles.green)} fr">
            <div>{stockMarketing.summaryData.bigSalesGrowthBig >(0) ?('+','')}{stockMarketing.summaryData.bigSalesGrowthBig}%</div>
          </div>
        </div>
      </div>
    </fj-Col>
    </#if>
    <#if {stockMarketing.tabItems[7].checked}>    
    <fj-Col l="3">
      <div class="{styles.summaryItem}">
        <div class="{styles.field}">滞销占比
          <ant-Popover content={popCntUnsales} title="指标释义">
            <ant-Icon type="question-circle" />
          </ant-Popover>
        </div>
        <div class="{styles.num}">{stockMarketing.summaryData.unsales} <span>%</span></div>
        <!-- <div class="tc"><img src="{iconGraph}" alt=""></div> -->
        <div class="{styles.rates} clearfix">
          <div class="{stockMarketing.summaryData.unsalesGrowth >(0) ?(styles.red,styles.green)} fr">
            <div>{stockMarketing.summaryData.unsalesGrowth >(0) ?('+','')}{stockMarketing.summaryData.unsalesGrowth}%</div>
          </div>
        </div>
      </div>
    </fj-Col>
    </#if>
  </fj-Row>
  <!--summary:end-->
</template>

<template name="stockMarketingMap">
  <div class="{styles.stockMarketingMapWrap}">
    <ul class="{styles.stockMarketingTab}">
      <#each {stockMarketing.tabItems}>
        <#if {checked}>
        <li key={@index} class="{currentTab ==(value) ?(styles.cur,'')}" onClick={onTabClick(value)}>{name}</li>
        </#if>
      </#each>
    </ul>
    <div class="{styles.tabCnt}">
      <div class="{styles.toolsBar} tr middle">
        <ant-Popover content={popTypeCnt} placement="bottomRight" title="指标设置" trigger="click">
          <ant-Button><ant-Icon type="setting" />指标设置</ant-Button>
        </ant-Popover>
        <ant-Button onClick={showSettingDlg}>目标设置</ant-Button>
        <ant-Popover content={popUploadCnt} placement="bottomRight" title="爆品上传" trigger="click">
          <ant-Button><ant-Icon type="upload" />爆品上传</ant-Button>
        </ant-Popover>
        <em class="{currentView ==(1) ?(styles.iconChartOn,styles.iconChart)}" onClick={switchView(1)}></em>
        <em class="{currentView ==(2) ?(styles.iconTableOn,styles.iconTable)}" onClick={switchView(2)}></em>
      </div>


      <#if {currentView ==(1)}>
        <!--# 整体趋势：start #-->
        <div class="{styles.ecTrendsWrap}">
          <div class="{styles.ecTrendsWrapTit}">
            <span class="{styles.ecTrendsWrapClose}" onClick="{switchView(0)}">X</span>
            整体趋势分析
          </div>
          <ec-LineChart ref="ecTrendsChart" option={toJS(trendsChartOptions)} data={toJS(trendsChartData)} update={true}/>
        </div>
      </#if>
      
      <#if {currentView ==(2)}>
        <div class="{styles.tableWrap}">
          <div class="{styles.tableWrapTit}">
            <span class="{styles.tableWrapClose}" onClick="{switchView(0)}">X</span>
          </div>
          <div class="{styles.tableWrapCnt}">
            <div class="fr">
              <span class="{styles.field}">分析维度:</span>
              <ant-RadioGroup defaultValue="brand" size="middle" onChange={onTableDownloadSortTypeChange} style="margin-right:10px">
                <ant-RadioButton value="brand">按品牌</ant-RadioButton>
                <ant-RadioButton value="category">按品类</ant-RadioButton>
              </ant-RadioGroup>
              <ant-Popover content={popTableDownloadCnt} placement="bottomRight" title="表格下载" trigger="click">
                <ant-Button><ant-Icon type="download" />表格下载</ant-Button>
              </ant-Popover>
            </div>
              <#switch {currentTab}>
                <#case {'inStock'}>
                <ant-RadioGroup defaultValue="1" value="1" size="large" onChange={onTableToolbarChange}>
                  <ant-RadioButton value="1">中小件</ant-RadioButton>
                </ant-RadioGroup>
                </#case>
                <#case {'inStockBig'}>
                <ant-RadioGroup defaultValue="2" value="2" size="large" onChange={onTableToolbarChange}>
                    <ant-RadioButton value="2">大件</ant-RadioButton>
                </ant-RadioGroup>
                </#case>
                <#case {'bigSales'}>
                <ant-RadioGroup defaultValue="1" value="1" size="large" onChange={onTableToolbarChange}>
                  <ant-RadioButton value="1">中小件</ant-RadioButton>
                </ant-RadioGroup>
                </#case>
                <#case {'bigSalesBig'}>
                <ant-RadioGroup defaultValue="2" value="2" size="large" onChange={onTableToolbarChange}>
                    <ant-RadioButton value="2">大件</ant-RadioButton>
                </ant-RadioGroup>
                </#case>
                <#default>
                <ant-RadioGroup defaultValue="0" value="{tableType}" size="large" onChange={onTableToolbarChange}>
                  <ant-RadioButton value="0">全部</ant-RadioButton>
                  <ant-RadioButton value="1">中小件</ant-RadioButton>
                  <ant-RadioButton value="2">大件</ant-RadioButton>
                </ant-RadioGroup>
                </#default>
              </#switch>
            <ant-Table columns={tableColumns} dataSource={tableData} scroll={tableScroll} pagination={false} />
          </div>
        </div>
      </#if>

      <#if {currentView ==(0)}>
      <!--# 地图&一级品类：start #-->
      <fj-Row class="clearfix">
        <fj-Col l="6">
          <div class="{styles.blockWrap}">
            <div class="clearfix">
              <#if {currentTab != 'inStock' && (currentTab != 'inStockBig') && (currentTab != 'bigSales') && (currentTab != 'bigSalesBig')}>
              <div class="fr">
                <span class="{styles.field}">{stockMarketing.filterSmallObject ?('中小件','大件')}</span><ant-Switch onChange={filterSmallObject} checked={stockMarketing.filterSmallObject} />
              </div>
              </#if>
              <span class="{styles.blockTit}">区域详情</span>
            </div>
            <div class="{styles.ecWrap}">
              <ec-MapChart ref="ecMap" option={mapOption} data={mapData} height={360} />
            </div>
          </div>
        </fj-Col>
        <fj-Col l="6">
          <div class="{styles.blockWrap}">
            <div class="clearfix">
              <span class="{styles.blockTit}">一级品类详情</span>
            </div>
            <div class="{styles.ecWrap}">
              <ec-BarChart ref="ecLevelOne" option={barLevelOneOption} data={barLevelOneData} height={360} />
            </div>
          </div>
        </fj-Col>
      </fj-Row>
      <!--# 地图&一级品类：end #-->
      </#if>


      <div class="{styles.ecBandWrap}">
        <div class="clearfix">
          <span class="{styles.blockTit}">Band详情</span>
        </div>
        <div class="{styles.ecWrap}">
          <#if {currentTab ==('stockMoney')}>
            <ec-BarChart ref="ecBandStockMoney" option={barStockMoneyBandOption} data={barStockMoneyBandData} height={300} />
          </#if>
          <#if {currentTab !=('stockMoney')}>
            <ec-BarChart ref="ecBand" option={barBandOption} data={barBandData} height={300} />
          </#if>
        </div>
      </div>

      <ant-Modal
          title="目标设置"
          width={500}
          visible={dlgTargetSettingVisible}
          onOk={dlgTargetSettingOk}
          onCancel={dlgTargetSettingCancel}
          class="dlgTargetSettings"
        >
          {dlgTargetSettingCnt}
        </ant-Modal>
    </div>
  </div>
</template>

<template name="dlgTargetSettings">
  <div class="{styles.dlgTargetSetting}">
    <div class="{styles.dlgTargetSettingTit}">
      <fj-Row class="clearfix">
          <fj-Col l="2" class="{styles.dlgField}">
            指标选择
          </fj-Col>
          <fj-Col l="10">
            <ant-Select style="width:80%" onChange={onTypeChange} defaultValue="pv" placeholder="请选择">
              <#each {ddlItems}>
                <ant-Option value="{value +('')}" key={@index}>{name}</ant-Option>
              </#each>
            </ant-Select>
          </fj-Col>
      </fj-Row>
    </div>
    <fj-Row class="clearfix">
        <fj-Col l="2" class="{styles.dlgField}">
          <div>月度目标</div>
          <div style="color:#999">{targetText}</div>
        </fj-Col>
        <fj-Col l="10">
          <fj-Row class="clearfix">
              <fj-Col l="4" class="{styles.monthCol}">
                <span>1月</span><ant-Input onChange={onMonthTargetChanged(0)} value={monthTarget[0]}/>
              </fj-Col>
              <fj-Col l="4" class="{styles.monthCol}">
                <span>2月</span><ant-Input onChange={onMonthTargetChanged(1)} value={monthTarget[1]} />
              </fj-Col>
              <fj-Col l="4" class="{styles.monthCol}">
                <span>3月</span><ant-Input onChange={onMonthTargetChanged(2)} value={monthTarget[2]} />
              </fj-Col>
          </fj-Row>
          <fj-Row class="clearfix">
              <fj-Col l="4" class="{styles.monthCol}">
                <span>4月</span><ant-Input onChange={onMonthTargetChanged(3)} value={monthTarget[3]} />
              </fj-Col>
              <fj-Col l="4" class="{styles.monthCol}">
                <span>5月</span><ant-Input onChange={onMonthTargetChanged(4)} value={monthTarget[4]} />
              </fj-Col>
              <fj-Col l="4" class="{styles.monthCol}">
                <span>6月</span><ant-Input onChange={onMonthTargetChanged(5)} value={monthTarget[5]} />
              </fj-Col>
          </fj-Row>
          <fj-Row class="clearfix">
              <fj-Col l="4" class="{styles.monthCol}">
                <span>7月</span><ant-Input onChange={onMonthTargetChanged(6)} value={monthTarget[6]} />
              </fj-Col>
              <fj-Col l="4" class="{styles.monthCol}">
                <span>8月</span><ant-Input onChange={onMonthTargetChanged(7)} value={monthTarget[7]} />
              </fj-Col>
              <fj-Col l="4" class="{styles.monthCol}">
                <span>9月</span><ant-Input onChange={onMonthTargetChanged(8)} value={monthTarget[8]} />
              </fj-Col>
          </fj-Row>
          <fj-Row class="clearfix">
              <fj-Col l="4" class="{styles.monthCol}">
                <span>10月</span><ant-Input onChange={onMonthTargetChanged(9)} value={monthTarget[9]} />
              </fj-Col>
              <fj-Col l="4" class="{styles.monthCol}">
                <span>11月</span><ant-Input onChange={onMonthTargetChanged(10)} value={monthTarget[10]} />
              </fj-Col>
              <fj-Col l="4" class="{styles.monthCol}">
                <span>12月</span><ant-Input onChange={onMonthTargetChanged(11)} value={monthTarget[11]} />
              </fj-Col>
          </fj-Row>
        </fj-Col>
    </fj-Row>
  </div>
</template>

<template name="popUploadCnt">
  <div>
    <div>
      <span>数据文件：</span>
      <ant-Upload {...uploadProps}>
        <ant-Button>
          <ant-Icon type="upload" /> 上传
        </ant-Button>
      </ant-Upload>
    </div>
    <div class="{styles.uploadBtn}">
      <a href={downloadUrl} target="_blank">下载模板</a>
      <a href={downloadUrlHotSku} target="_blank">下载爆品</a>
    </div>
  </div>
</template>

<template name="popTableDownloadCnt">
  <div>
    <form action={downloadUrl} target="ifrExport" method="post" ref="formExport">
      <input type="hidden" name="deptId" value="{conditions.deptId}">
      <input type="hidden" name="categoryId1" value="{conditions.categoryId1}">
      <input type="hidden" name="categoryId1" value="{conditions.categoryId1}">
      <input type="hidden" name="categoryId2" value="{conditions.categoryId2}">
      <input type="hidden" name="categoryId3" value="{conditions.categoryId3}">
      <input type="hidden" name="brandId" value="{conditions.brandId}">
      <input type="hidden" name="date" value="{conditions.date}">
      <input type="hidden" name="dataRange" value="{conditions.dataRange}">
      <input type="hidden" name="tableType" value="{conditions.tableType}">
      <input type="hidden" name="storeType" value="{conditions.storeType}">
      <input type="hidden" name="tableDownloadType" value="{tableDownloadType}">
      <input type="hidden" name="tableStartType" value="{tableDownloadSortType}">
      <input type="hidden" name="dateType" value="{conditions.dateType}">
      <input type="hidden" name="indexType" value="{indexType}">
      <iframe style="display:none" id="ifrExport" name="ifrExport" src="about:blank"></iframe>
      <ant-Select value={tableDownloadType} style="width:120px;margin-right:10px;" onChange={tableDownloadTypeChanged} getPopupContainer={preventHide}>
        <#if {tableDownloadSortType == 'brand'}>
          <ant-Option value="brand">品牌</ant-Option>
          <ant-Option value="category1">一级品类</ant-Option>
          <ant-Option value="category2">二级品类</ant-Option>
          <ant-Option value="category3">三级品类</ant-Option>
          <#else>
          <ant-Option value="category1">一级品类</ant-Option>
          <ant-Option value="category2">二级品类</ant-Option>
          <ant-Option value="category3">三级品类</ant-Option>
          <ant-Option value="brand">品牌</ant-Option>
          </#else>
        </#if>
      </ant-Select>
      <ant-Button onClick={downloadEvent}>
        <ant-Icon type="download" /> 下载
      </ant-Button>
    </form>
  </div>
</template>

<template name="popTypeCnt">
  <div>
    <ul>
      <#each {stockMarketing.tabItems}>
      <li key={@index}>
        <ant-Checkbox onChange={onTypeChecked(@index)} checked={checked}>{name}</ant-Checkbox>
      </li>
      </#each>
    </ul>
  </div>
</template>
