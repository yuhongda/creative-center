<template name="privilegeManagement">
  <div class="{styles.privilegeManagement}">
    <fj-row gutter={20}>
      <fj-col l=4>
        <h2>用户列表</h2>
        <UserList />
      </fj-col>
      <fj-col l=4>
        <h2>角色列表</h2>
        <RoleList />
      </fj-col>
      <fj-col l=4>
        <h2>数据权限</h2>
        <DataAuth />
      </fj-col>
    </fj-row>
  </div>
</template>

<template name="userList">
  <div class="basePanel">
    <fj-row class="{styles.btns}">
      <fj-col l=4>
        <ant-Button class="btn" onClick={onAdd}>新增</ant-Button>
      </fj-col>
      <fj-col l=4>
        <ant-Button class="btn" onClick={onEdit}>编辑</ant-Button>
      </fj-col>
      <fj-col l=4>
        <ant-Button class="btn" onClick={onDelete}>删除</ant-Button>
      </fj-col>
    </fj-row>
    <div class="{styles.userList}">
      <#each {privilegeManagement.userData}>
        <div key={@index} class={styles.userItem}>
          <fj-row>
            <div class={styles.userName}>{userName}</div>
            <div class={styles.userDept}>{deptName}</div>
            <fj-rowright class={styles.checkbox}>
              <ant-Checkbox value={userId} {checked} onChange={onCheckboxChange} />
            </fj-rowright>
          </fj-row>
          <div>
            <div class={styles.userInfo}>
              <fj-rowleft width={60}>登录账号：</fj-rowleft>
              <fj-row left={65}>{loginName}</fj-row>
            </div>
            <div class={styles.userInfo}>
              <fj-rowleft width={60}>邮箱：</fj-rowleft>
              <fj-row left={65}>{email}</fj-row>
            </div>
            <div class={styles.userInfo}>
              <fj-rowleft width={60}>职务：</fj-rowleft>
              <fj-row left={65}>{post}</fj-row>
            </div>
          </div>
        </div>
      </#each>
    </div>
    <ant-Modal
      title="{modalTitle}"
      width={500}
      visible={modalVisible}
      footer={null}
      onCancel={onModalCancel}>
      <ant-Form class="{styles.userForm}" {onSubmit}>
        <fj-row class={styles.formItem}>
          <fj-rowleft width={70}><span class={styles.required}>*</span>京东账号：</fj-rowleft>
          <fj-row left={80}>
            <ant-FormItem>
              <#loginName>
                <ant-Input />
              </#loginName>
            </ant-FormItem>
          </fj-row>
        </fj-row>
        <fj-row class={styles.formItem}>
          <fj-rowleft width={70}>姓名：</fj-rowleft>
          <fj-row left={80}>
            <ant-FormItem>
              <#userName>
                <ant-Input />
              </#userName>
            </ant-FormItem>
          </fj-row>
        </fj-row>
        <fj-row class={styles.formItem}>
          <fj-rowleft width={70}><span class={styles.required}>*</span>邮箱：</fj-rowleft>
          <fj-row left={80}>
            <ant-FormItem>
              <#email>
                <ant-Input />
              </#email>
            </ant-FormItem>
          </fj-row>
        </fj-row>
        <fj-row class={styles.formItem}>
          <fj-rowleft width={70}>部门：</fj-rowleft>
          <fj-row left={80}>
            <ant-FormItem>
              <#deptName>
                <ant-Input />
              </#deptName>
            </ant-FormItem>
          </fj-row>
        </fj-row>
        <fj-row class={styles.formItem}>
          <fj-rowleft width={70}>职务：</fj-rowleft>
          <fj-row left={80}>
            <ant-FormItem>
              <#post>
                <ant-Input />
              </#post>
            </ant-FormItem>
          </fj-row>
        </fj-row>
        <div class={styles.formBottom}>
          <ant-Button class="btn" htmlType="submit">保存</ant-Button>
        </div>
      </ant-Form>
    </ant-Modal>
  </div>
</template>

<template name="roleList">
  <div class="basePanel {styles.roleList}">
    <fj-row>
      <fj-rowleft width={85} class={styles.infoLabel}>角色：</fj-rowleft>
      <fj-row left={95} right={90}>
        <ant-Select style="width:100%" onChange={onRoleChange} value="{privilegeManagement.selectedRoleId + ''}" placeholder="请分配角色">
          <#each {privilegeManagement.roleData}>
            <ant-Option value="{roleId + ''}" key={@index}>{roleName}</ant-Option>
          </#each>
        </ant-Select>
      </fj-row>
      <fj-rowright width={80}>
        <ant-Button class="btn" onClick={onAdd}>添加</ant-Button>
      </fj-rowright>
    </fj-row>
    <fj-row>
      <fj-rowleft width={85} class={styles.infoLabel}>描述：</fj-rowleft>
      <fj-row left={95} class={styles.roleDescription}>
        <#with {privilegeManagement.selectedRole.('description')} as="des">
          {des ? (des, '暂无描述')}
        </#with>
      </fj-row>
    </fj-row>
    <fj-row>
      <fj-rowleft width={85} class={styles.infoLabel}>已开通角色：</fj-rowleft>
      <fj-row left={95}>
        <ant-Table dataSource="{privilegeManagement.userRoleData | toJS}"
                   pagination={false}
                   rowKey="roleId"
                   bordered
                   scroll="{
                     privilegeManagement.userRoleData.length > 3 ? (
                       obj('y' : 120),
                       undefined
                     )
                   }">
          <ant-TableColumn
            title="角色"
            dataIndex="roleName"
            key="roleName">
          </ant-TableColumn>
          <ant-TableColumn
            title="操作"
            dataIndex="roleId"
            key="roleId"
            width={60}>
            <@render>
              <#fn text record index>
                <a onClick="{onRowDelete(text, record, index)}">删除</a>
              </#fn>
            </@render>
          </ant-TableColumn>
        </ant-Table>
      </fj-row>
    </fj-row>
    <fj-row>
      <fj-rowleft width={85} class={styles.infoLabel}>已开通功能：</fj-rowleft>
      <fj-row left={95} style="height:435px;overflow-y:auto">
        <#if {privilegeManagement.authTreeData && privilegeManagement.authTreeData.length}>
          <ant-Tree key={privilegeManagement.authTreeKey}
                    defaultExpandAll>
                    {loop(privilegeManagement.authTreeData | toJS)}
          </ant-Tree>
        </#if>
      </fj-row>
    </fj-row>
  </div>
</template>

<template name="dataAuth">
  <div class="basePanel {styles.dataAuth}">
    <fj-row>
      <fj-rowright>
        <ant-Button class="btn" onClick={onAdd}>添加</ant-Button>
      </fj-rowright>
    </fj-row>
    <fj-row>
      <fj-rowleft width={60} class={styles.infoLabel}>品类：</fj-rowleft>
      <fj-row left={70}>
         <ant-Cascader options="{conditions.categoryData | toJS}"
                       value="{conditions.selectedCategory | toJS}"
                       onChange={onCategoryChange}
                       style="width:100%"
                       placeholder="全部"
                       changeOnSelect
                       allowClear />
      </fj-row>
    </fj-row>
    <fj-row>
      <fj-rowleft width={60} class={styles.infoLabel}>品牌：</fj-rowleft>
      <fj-row left={70}>
        <ant-Select style="width:100%" onChange={onBrandChange} value="{conditions.selectedBrand + ''}" placeholder="请选择">
          <#each {conditions.brandData}>
            <ant-Option value="{value + ''}" key={@index}>{label}</ant-Option>
          </#each>
        </ant-Select>
      </fj-row>
    </fj-row>
    <fj-row>
      <ant-Table dataSource="{privilegeManagement.accountInfo.categoryData | toJS}"
                 pagination={false}
                 bordered
                 rowKey="key"
                 scroll="{obj('x' : 420, 'y' : 560)}">
        <ant-TableColumn
          title=""
          dataIndex=""
          key="treeName"
          width={70}
          className={styles.treeCol}>
        </ant-TableColumn>
        <ant-TableColumn
          title="一级品类"
          dataIndex="oneBrand"
          key="oneBrand"
          width={75}>
        </ant-TableColumn>
        <ant-TableColumn
          title="二级品类"
          dataIndex="twoBrand"
          key="twoBrand"
          width={75}>
        </ant-TableColumn>
        <ant-TableColumn
          title="三级品类"
          dataIndex="threeBrand"
          key="threeBrand"
          width={75}>
        </ant-TableColumn>
        <ant-TableColumn
          title="品牌"
          dataIndex="brand"
          key="brand"
          width={75}>
        </ant-TableColumn>
        <ant-TableColumn
          title="操作"
          dataIndex="key"
          key="key"
          width={50}>
          <@render>
            <#fn text record index>
              <a onClick="{onRowDelete(text, record, index)}">删除</a>
            </#fn>
          </@render>
        </ant-TableColumn>
      </ant-Table>
    </fj-row>
  </div>
</template>