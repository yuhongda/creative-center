<template name="userUpgrade">
  <div class="{styles.userUpgrade}">
    <!--查询条件-->
    <#if {currentTab == (1)}>
      <conditions {onSearch} showCategory showBrand showDate defaultValueType=5 />
      <#else>
      <conditions {onSearch} showCategory showDate defaultValueType=5 />      
      </#else>
    </#if>
    <div class="{styles.tabWrap}">
      <ant-Tabs defaultActiveKey="1" onChange={callback}>
        <ant-TabPane tab="用户行为" key="1">
          <userBehavior />
        </ant-TabPane>
        <ant-TabPane tab="跨品类拉新" key="2">
          <categoryCorrelation />
          <userPrefer />
        </ant-TabPane>
         <ant-TabPane tab="品类内拉新" key="3">
          <salesRank />
        </ant-TabPane> 
      </ant-Tabs>
    </div>
  </div>
</template>

<template name="userBehavior">
  <div class="{styles.userBehavior}">
    <div class="{styles.pageSubTitle}">
      留存用户趋势-年度累计
    </div>
    <ec-BarChart ref="ecUserTrends" option={barUserTrendsOption} data={barUserTrendsData} />
    <div class="{styles.pageSubTitle}">
      用户留存
    </div>
    <ec-BarChart ref="ecUserRetention" option={barUserRetentionOption} data={barUserRetentionData} />
    <fj-Row class="clearfix">
      <fj-Col l="5">
        <div class="{styles.pageSubTitle}">
          新客来源
        </div>
        <ul>
          <li>新增用户：{userUpgrade.userSourceData.('newUserCount') ||('--')}</li>
          <li>占基期留存用户：{userUpgrade.userSourceData.('userRetentionRate') | percent(2) ||('--')}</li>
          <!-- <li>同比增长：{userUpgrade.userSourceData.('userGrowth') | percent(2) ||('--')}</li> -->
        </ul>
        <div class={styles.chartUserSource}>
          <ec-BarChart ref="ecUserSource" option={barUserSourceOption} data={barUserSourceData} />
        </div>
      </fj-Col>
      <fj-Col l="7">
        <div class="{styles.pageSubTitle}">
          留存用户行为
        </div>
        <ec-LineChart ref="ecUserBehavior" option={toJS(userBehaviorOptions)} data={toJS(userBehaviorData)} update={true}/>
      </fj-Col>
    </fj-Row>

    <div class="{styles.pageSubTitle}">
      最受欢迎sku
    </div>
    <fj-Row class="{styles.preferSku} clearfix">
      <fj-Col l="6" class={styles.tableWrap}>
        <div class="{styles.tableTit}"><ant-Icon type="smile-o" />新客最爱</div>
        <ant-Table columns={toJS(tableNewUserColumns)} dataSource={toJS(tableNewUserData)} size="middle" pagination={false} />
      </fj-Col>
      <fj-Col l="6" class={styles.tableWrap}>
        <div class="{styles.tableTit}"><ant-Icon type="smile-o" />老客最爱</div>
        <ant-Table columns={toJS(tableOldUserColumns)} dataSource={toJS(tableOldUserData)} size="middle" pagination={false} />
      </fj-Col>
    </fj-Row>
  </div>
</template>

<template name="categoryCorrelation">
  <div class="{styles.categoryCorrelation}">
    <div class="{styles.pageSubTitle}">
      品类关联度
    </div>
    <fj-Row class="clearfix">
      <fj-Col l="6">
        <ec-GraphChart ref="ecCategoryCorrelation" option={graphCategoryCorrelationOption} data={graphCategoryCorrelationData} />        
      </fj-Col>
      <fj-Col l="6">
        <categoryCorrelationTable />
      </fj-Col>
    </fj-Row>
  </div>
</template>

<template name="categoryCorrelationTable">
  <ant-Table columns={toJS(tableCategoryCorrelationColumns)} dataSource={toJS(tableCategoryCorrelationData)} onRowClick={onCategorySelected} rowClassName={renderRowClass} size="middle" pagination={false} />
</template>


<template name="userPrefer">
  <div class="{styles.userPrefer}">
    <div class="{styles.pageSubTitle}">
      关联用户偏好
    </div>
    <fj-Row class="clearfix">
      <fj-Col l="3" class="{styles.tableWrap}">
        <div class="{styles.tableTit}"><ant-Icon type="smile-o" />重合用户品牌偏好</div>
        <ant-Table columns={toJS(tableBrandColumns)} dataSource={tableBrandData} size="middle" pagination={false} onRowClick={onBrandSelected} rowClassName={renderRowClass} />
      </fj-Col>
      <fj-Col l="9" class="{styles.tableWrapRight}">
        <div class="{styles.tableTit}">品牌重合度</div>
        <ant-Table columns={toJS(tableCoincidenceColumns)} dataSource={toJS(tableCoincidenceData)} size="middle" pagination={false} />
      </fj-Col>
    </fj-Row>
  </div>
</template>


<template name="salesRank">
  <div class="{styles.salesRank}">
    <div class="{styles.pageSubTitle}">
      京东内销售排名
    </div>
    <fj-Row class="clearfix">
      <fj-Col l="3" class="{styles.tableWrap}">
        <div class="{styles.txtSearchWrap}">
          <ant-Input placeholder="输入搜索品牌" onChange={onSearchChange} />
        </div>
        <ant-Table columns={toJS(tableBrandRankColumns)} dataSource={tableBrandRankData} size="middle" pagination={false} rowSelection={rowSelection} scroll={tableSetting} />
      </fj-Col>
      <fj-Col l="9" class="{styles.tableWrapRight}">
        <fj-Row class="clearfix">
          <fj-Col l="6">
            <div class="{styles.tableTit}"><ant-Icon type="smile-o" />重合用户占比</div>
            <ul>
              <#each {userUpgrade.selectedBrandItems}>
                <li class="middle" key={@index}>
                  <span class="{@index == (0) ?(styles.pickedBrandRank0,styles.pickedBrandRank1)}">{rank}</span>
                  <img src="{brandLogo ||(defaultLogo)}" alt="" class="{styles.pickedBrandLogo}">
                  <span class="{@index == (0) ?(styles.pickedBrandName0,styles.pickedBrandName1)}">{brandName}</span>
                  <ant-Button size="small" onClick={removeSelectedBrand(id)}><ant-Icon type="close" /></ant-Button>
                </li>
              </#each>
            </ul>
            <div class="{styles.rates}">{userUpgrade.userCoincidenceRates | percent(2)}</div>
            <div class="{styles.note}">-{userUpgrade.selectedBrandItems.(0).('brandName') ||('')}和{userUpgrade.selectedBrandItems.(1).('brandName') ||('')}的重合用户数在{userUpgrade.selectedBrandItems.(0).('brandName') ||('')}用户中的占比。</div>
          </fj-Col>
          <fj-Col l="6">
            <div class="{styles.tableTit}"><ant-Icon type="dot-chart" />用户增长力模型</div>
            <ec-RadarChart ref="ecRadar" option={radarOption} data={radarData} />
          </fj-Col>
        </fj-Row>
      </fj-Col>
    </fj-Row>
  </div>
</template>
